<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QuatroC • Portal de Negociação</title>

  <style>
    :root{
      --red:#c8102e;
      --red2:#e3122f;
      --ink:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --bg:#f6f7fb;
      --card:#ffffff;
      --radius:22px;
      --shadow: 0 18px 50px rgba(17,24,39,.10);
      --shadow2: 0 10px 30px rgba(17,24,39,.08);
      --maxw: 860px; /* mantém proporcional e evita “telas gigantes” */
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink);
      background: radial-gradient(1200px 500px at 50% -150px, rgba(200,16,46,.10), transparent 60%),
                  radial-gradient(900px 500px at 20% 110%, rgba(200,16,46,.06), transparent 60%),
                  var(--bg);
    }

    .shell{
      min-height:100%;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px 16px;
    }

    .frame{
      width:min(var(--maxw), 100%);
      background:rgba(255,255,255,.72);
      border:1px solid rgba(229,231,235,.7);
      border-radius:28px;
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(8px);
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px 18px 10px;
      background: linear-gradient(to bottom, rgba(255,255,255,.85), rgba(255,255,255,.55));
      border-bottom:1px solid rgba(229,231,235,.6);
    }

    .brand{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:12px;
    }
    .brand img{
      height:64px;
      width:auto;
      display:block;
      filter: drop-shadow(0 10px 18px rgba(17,24,39,.08));
    }
    .brand .fallback{
      display:none;
      font-weight:800;
      letter-spacing:.2px;
      color:var(--ink);
    }

    .content{
      padding:20px 22px 6px;
    }

    .navrow{
      display:flex;
      align-items:center;
      justify-content:flex-start;
      gap:10px;
      margin:4px 2px 14px;
    }
    .backlink{
      border:none;
      background:transparent;
      color:var(--muted);
      font-weight:600;
      cursor:pointer;
      padding:8px 10px;
      border-radius:10px;
    }
    .backlink:hover{background:rgba(17,24,39,.04); color:var(--ink);}

    .panel{
      background:var(--card);
      border:1px solid rgba(229,231,235,.8);
      border-radius:var(--radius);
      box-shadow: var(--shadow2);
      padding:26px 22px;
    }

    .title{
      font-size: clamp(28px, 3.5vw, 44px);
      line-height:1.05;
      margin:0 0 10px;
      letter-spacing:-.7px;
      text-align:center;
    }
    .subtitle{
      margin:0 0 18px;
      color:var(--muted);
      text-align:center;
      font-size: clamp(14px, 1.6vw, 18px);
    }

    .divider{
      height:1px;
      background:rgba(229,231,235,.85);
      margin:18px 0;
    }

    .center{
      text-align:center;
    }

    .row{
      display:flex;
      gap:14px;
      justify-content:center;
      align-items:stretch;
      flex-wrap:wrap;
    }

    .btn{
      appearance:none;
      border:1.5px solid rgba(200,16,46,.45);
      background:#fff;
      color:var(--red);
      border-radius:18px;
      padding:16px 18px;
      font-weight:800;
      cursor:pointer;
      min-width: 200px;
      max-width: 320px;
      width: 100%;
      transition: transform .06s ease, background .18s ease, color .18s ease, border-color .18s ease;
      box-shadow: 0 10px 22px rgba(17,24,39,.06);
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(200,16,46,.70); }
    .btn:active{ transform: translateY(0px) scale(.99); }

    .btn.primary{
      background: linear-gradient(180deg, var(--red2), var(--red));
      color:#fff;
      border-color: rgba(200,16,46,.80);
    }
    .btn.primary:hover{ filter: brightness(1.02); }

    /* quando quer “mesma cor” (Sim/Não e Direcionamento): ambos brancos, destaque no hover/foco */
    .btn.same{
      background:#fff;
      color:var(--red);
    }

    .btn.small{
      min-width: 160px;
      max-width: 240px;
      padding:14px 16px;
      border-radius:16px;
      font-size:16px;
    }

    .btn.wide{
      max-width: 520px;
    }

    .inputWrap{
      display:flex;
      flex-direction:column;
      gap:10px;
      max-width: 520px;
      margin:0 auto;
    }
    label{font-weight:700; color:var(--ink)}
    .hint{font-size:13px; color:var(--muted); margin-top:-6px}

    input{
      width:100%;
      font-size:18px;
      padding:16px 16px;
      border-radius:16px;
      border:1px solid rgba(229,231,235,.9);
      outline:none;
      box-shadow: 0 10px 22px rgba(17,24,39,.05);
    }
    input:focus{
      border-color: rgba(200,16,46,.50);
      box-shadow: 0 0 0 4px rgba(200,16,46,.10), 0 10px 22px rgba(17,24,39,.06);
    }

    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:12px 14px;
      border-radius:999px;
      background: rgba(17,24,39,.04);
      border:1px solid rgba(229,231,235,.9);
      font-weight:800;
      margin:0 auto;
    }
    .dot{
      width:10px; height:10px; border-radius:99px;
      background: var(--red);
      box-shadow: 0 0 0 6px rgba(200,16,46,.12);
    }
    .loadingText{ margin:12px 0 0; color:var(--muted); text-align:center; font-weight:600; }

    .footer{
      padding:16px 20px 22px;
      text-align:center;
      color:var(--muted);
      font-size:14px;
    }
    .footer a{
      color:var(--red);
      text-decoration:none;
      font-weight:800;
    }
    .footer a:hover{text-decoration:underline;}

    /* Modal Termos e Política (caixa proporcional + scroll interno) */
    .modalOverlay{
      position:fixed;
      inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      background: rgba(17,24,39,.55);
      z-index:50;
    }
    .modal{
      width:min(720px, 100%);
      max-height: min(74vh, 680px);
      background:#fff;
      border-radius:18px;
      border:1px solid rgba(229,231,235,.9);
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .modalHeader{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:14px 16px;
      border-bottom:1px solid rgba(229,231,235,.9);
      background: rgba(255,255,255,.95);
    }
    .modalHeader strong{font-size:15px}
    .modalClose{
      border:none;
      background:transparent;
      cursor:pointer;
      font-size:22px;
      line-height:1;
      padding:6px 10px;
      border-radius:10px;
      color:var(--muted);
    }
    .modalClose:hover{background:rgba(17,24,39,.06); color:var(--ink);}
    .modalBody{
      padding:16px 18px 18px;
      overflow:auto;
      color:#111827;
    }
    .modalBody h3{ margin:14px 0 8px; font-size:16px; }
    .modalBody p, .modalBody li{ color:#374151; line-height:1.55; }
    .modalBody ul{ margin:8px 0 0 18px; }

    /* util */
    .hidden{ display:none !important; }

    @media (max-width:640px){
      .panel{ padding:22px 16px; }
      .btn{ min-width: 160px; }
      .brand img{ height:56px; }
      .content{ padding:18px 14px 6px; }
    }
  </style>
</head>

<body>
  <div class="shell">
    <div class="frame" role="application" aria-label="Portal de negociação QuatroC">
      <div class="topbar">
        <div class="brand" aria-label="QuatroC">
          <img id="logoImg" src="https://cdn.jsdelivr.net/gh/asilvino19-beep/Logo@main/Logo.png" alt="QuatroC" />
          <div id="logoFallback" class="fallback">QuatroC</div>
        </div>
      </div>

      <div class="content">
        <div class="navrow">
          <button class="backlink" id="btnVoltar" type="button">← Voltar</button>
        </div>

        <!-- TELA 1 (inicial) -->
        <section id="viewStart" class="panel">
          <h1 class="title">Acesse ao portal de negociação</h1>
          <p class="subtitle">Preencha o campo abaixo</p>

          <div class="inputWrap" style="margin-top:10px;">
            <label for="docInput">Digite seu CPF ou CNPJ</label>
            <div class="hint">Aceita colar com pontuação</div>
            <input id="docInput" inputmode="numeric" autocomplete="off" placeholder="000.000.000-00" />
            <div class="row" style="margin-top:10px;">
              <button class="btn primary wide" id="btnConsultar" type="button">Confirmar</button>
            </div>
          </div>
        </section>

        <!-- TELA 2 (carregando) — SEM “Resultado da consulta” -->
        <section id="viewLoading" class="panel hidden">
          <p class="subtitle" style="margin:0; font-weight:700;">
            Estamos localizando as informações vinculadas ao documento informado.
          </p>

          <div style="margin-top:18px;" class="center">
            <div class="pill" aria-live="polite">
              <span class="dot" aria-hidden="true"></span>
              <span>Carregando...</span>
            </div>
            <div class="loadingText">Aguarde um momento.</div>
          </div>
        </section>

        <!-- TELA 3 (resultado + confirmação Sim/Não) -->
        <section id="viewConfirm" class="panel hidden">
          <h2 class="title" style="margin-bottom:10px;">Resultado da consulta</h2>

          <div class="divider"></div>

          <p id="confirmText" class="subtitle" style="margin:0; font-size:18px; color:var(--ink); font-weight:700; line-height:1.4; text-align:center;">
            <!-- preenchido via JS -->
          </p>

          <div class="row" style="margin-top:18px;">
            <button class="btn same small" id="btnSim" type="button">Sim</button>
            <button class="btn same small" id="btnNao" type="button">Não</button>
          </div>
        </section>

        <!-- TELA 4 (validação do nome completo / razão social) — SEM “Validação de segurança” e SEM “Confirmação” -->
        <section id="viewVerifyName" class="panel hidden">
          <h2 class="title" style="margin-bottom:6px;">&nbsp;</h2>
          <p class="subtitle" style="margin-bottom:18px;">Para darmos sequência, confirme o nome completo</p>

          <div class="row" id="nameOptions" style="flex-direction:column; align-items:center; gap:12px;">
            <!-- botões de opções via JS -->
          </div>
        </section>

        <!-- TELA 5 (direcionamento) — tamanho proporcional + botões alinhados e mesma cor -->
        <section id="viewNextStep" class="panel hidden">
          <h2 class="title" style="margin-bottom:8px;">Como deseja prosseguir?</h2>
          <p class="subtitle">Selecione uma opção para continuar o atendimento.</p>

          <div class="row" style="margin-top:10px;">
            <button class="btn same" id="btnAuto" type="button">Negociar agora pelo autoatendimento</button>
            <button class="btn same" id="btnHumano" type="button">Falar com um atendente</button>
          </div>
        </section>

        <!-- TELA 6 (negociação - card de proposta + botão detalhes da dívida) -->
        <section id="viewOffer" class="panel hidden">
          <h2 class="title" style="margin-bottom:8px;">Negociações disponíveis</h2>
          <p class="subtitle">Escolha uma oferta para seguir com o acordo.</p>

          <div style="max-width:720px; margin:0 auto;">
            <div style="border:1px solid rgba(229,231,235,.9); border-radius:18px; overflow:hidden; box-shadow:0 10px 24px rgba(17,24,39,.06);">
              <div style="padding:16px 16px; background: rgba(17,24,39,.02); display:flex; align-items:center; justify-content:space-between; gap:10px;">
                <div style="font-weight:900;">Oferta do dia</div>
                <button id="btnDetalhesDivida" class="backlink" style="color:var(--red); font-weight:900;" type="button">Detalhes da dívida</button>
              </div>

              <div style="padding:18px 16px;">
                <div style="display:flex; justify-content:space-between; gap:14px; flex-wrap:wrap;">
                  <div>
                    <div style="color:var(--muted); font-weight:700; font-size:13px;">Parcelado em</div>
                    <div id="offerParcelas" style="font-size:22px; font-weight:900;">24x de R$ 10,06</div>
                  </div>
                  <div>
                    <div style="color:var(--muted); font-weight:700; font-size:13px; text-align:right;">Total</div>
                    <div id="offerTotal" style="font-size:22px; font-weight:900; text-align:right;">R$ 241,44</div>
                  </div>
                </div>

                <div class="divider"></div>

                <div class="row" style="margin-top:6px;">
                  <button class="btn primary wide" id="btnQueroOferta" type="button">Quero essa oferta</button>
                  <button class="btn wide" id="btnOutrasOfertas" type="button">Ver outras ofertas</button>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- TELA 7 (atendente humano) -->
        <section id="viewHuman" class="panel hidden">
          <h2 class="title" style="margin-bottom:8px;">Atendimento humano</h2>
          <p class="subtitle">Clique no botão abaixo para falar com um atendente.</p>

          <div class="row" style="margin-top:10px;">
            <a class="btn primary wide center" id="btnAbrirChat" href="#" target="_blank" rel="noopener">Abrir chat com atendente</a>
          </div>
        </section>

        <!-- TELA 8 (nova consulta / documento incorreto OU nome incorreto) -->
        <section id="viewNewSearch" class="panel hidden">
          <h2 id="newSearchTitle" class="title" style="margin-bottom:8px;">Nova consulta</h2>
          <p id="newSearchMsg" class="subtitle" style="max-width:720px; margin:0 auto;">
            Para sua segurança, precisamos reiniciar a consulta com o documento correto.
          </p>

          <div class="row" style="margin-top:14px;">
            <button class="btn primary wide" id="btnNovaConsulta" type="button">Nova consulta</button>
          </div>
        </section>

        <!-- TELA 9 (instabilidade) — visual mais “leve” e coerente -->
        <section id="viewError" class="panel hidden">
          <h2 class="title" style="margin-bottom:8px;">Não foi possível concluir</h2>
          <p class="subtitle" id="errorMsg">Houve uma instabilidade no momento. Tente novamente em instantes.</p>

          <div class="row" style="margin-top:12px;">
            <button class="btn primary wide" id="btnTentarNovamente" type="button">Tentar novamente</button>
            <button class="btn wide" id="btnVoltarInicio" type="button">Voltar ao início</button>
          </div>
        </section>
      </div>

      <div class="footer">
        Conosco, seus dados são tratados de forma segura e sigilosa.
        Caso tenha dúvidas ou queira saber mais, acesse nossos
        <a href="#" id="openTerms">Termos e Política</a>.
      </div>
    </div>
  </div>

  <!-- Modal Termos e Política -->
  <div class="modalOverlay" id="termsOverlay" role="dialog" aria-modal="true" aria-label="Termos e Política">
    <div class="modal">
      <div class="modalHeader">
        <strong>Termos e Política</strong>
        <button class="modalClose" id="closeTerms" type="button" aria-label="Fechar">×</button>
      </div>
      <div class="modalBody">
        <h3>Compromisso com segurança e sigilo</h3>
        <p>
          A QuatroC adota medidas técnicas e organizacionais para proteger os dados utilizados neste portal,
          com foco em confidencialidade, integridade e disponibilidade das informações.
        </p>

        <h3>1) Finalidade do portal</h3>
        <p>
          Este portal viabiliza o autoatendimento para consulta de pendências e direcionamento do atendimento,
          de forma objetiva e segura.
        </p>

        <h3>2) Dados tratados</h3>
        <ul>
          <li>Documento informado (CPF ou CNPJ);</li>
          <li>Informações cadastrais necessárias para atendimento (ex.: contatos e endereços quando aplicável);</li>
          <li>Informações sobre pendências/encaminhamentos vinculados ao documento consultado.</li>
        </ul>

        <h3>3) Sigilo e acesso</h3>
        <p>
          Para reduzir exposição indevida, o portal pode solicitar validações adicionais antes de exibir informações.
          Não compartilhe seu documento com terceiros.
        </p>

        <h3>4) Boas práticas</h3>
        <ul>
          <li>Utilize rede e dispositivo confiáveis;</li>
          <li>Evite acessar o portal em equipamentos públicos;</li>
          <li>Finalize o atendimento ao concluir sua consulta.</li>
        </ul>

        <h3>5) Atendimento humano</h3>
        <p>
          Caso prefira, você pode optar por seguir com atendimento humano pelos canais disponibilizados neste portal.
        </p>
      </div>
    </div>
  </div>

  <script>
    /* ===============================
      ✅ AJUSTES APLICADOS (resumo)
      - “Resultado da consulta” só aparece quando existe resultado (viewConfirm).
      - Loading: somente a frase solicitada + sem borda extra.
      - Sim → vai direto para validação do nome completo (sem novo loading).
      - Não → vai para Nova consulta com explicação (sem “Resultado da consulta”).
      - CPF vs CNPJ: texto de confirmação diferente.
      - Termos e Política: modal proporcional (caixa + scroll interno).
      - Voltar e Nova consulta: sempre retornam para a tela inicial.
      - Removeu alert/popup do “card”; agora navega para telas.
      - Ajustes de proporção/tamanho e botões alinhados/mesma cor.
    =============================== */

    const views = {
      start: document.getElementById('viewStart'),
      loading: document.getElementById('viewLoading'),
      confirm: document.getElementById('viewConfirm'),
      verifyName: document.getElementById('viewVerifyName'),
      nextStep: document.getElementById('viewNextStep'),
      offer: document.getElementById('viewOffer'),
      human: document.getElementById('viewHuman'),
      newSearch: document.getElementById('viewNewSearch'),
      error: document.getElementById('viewError'),
    };

    function show(viewKey){
      Object.keys(views).forEach(k => views[k].classList.add('hidden'));
      views[viewKey].classList.remove('hidden');
      currentView = viewKey;
    }

    // Navegação
    let currentView = 'start';
    const navStack = [];

    function pushAndShow(viewKey){
      if (currentView) navStack.push(currentView);
      show(viewKey);
    }
    function goBack(){
      // regra simples: voltar uma tela; se vazio, volta início
      const prev = navStack.pop();
      show(prev || 'start');
    }
    function goHome(){
      navStack.length = 0;
      show('start');
      resetFlowState();
    }

    // Elementos
    const btnVoltar = document.getElementById('btnVoltar');
    const btnConsultar = document.getElementById('btnConsultar');
    const docInput = document.getElementById('docInput');

    const confirmText = document.getElementById('confirmText');
    const btnSim = document.getElementById('btnSim');
    const btnNao = document.getElementById('btnNao');

    const nameOptions = document.getElementById('nameOptions');

    const btnAuto = document.getElementById('btnAuto');
    const btnHumano = document.getElementById('btnHumano');

    const btnNovaConsulta = document.getElementById('btnNovaConsulta');
    const newSearchMsg = document.getElementById('newSearchMsg');

    const btnTentarNovamente = document.getElementById('btnTentarNovamente');
    const btnVoltarInicio = document.getElementById('btnVoltarInicio');

    const btnDetalhesDivida = document.getElementById('btnDetalhesDivida');
    const btnQueroOferta = document.getElementById('btnQueroOferta');
    const btnOutrasOfertas = document.getElementById('btnOutrasOfertas');

    const offerParcelas = document.getElementById('offerParcelas');
    const offerTotal = document.getElementById('offerTotal');

    const btnAbrirChat = document.getElementById('btnAbrirChat');

    // Termos modal
    const openTerms = document.getElementById('openTerms');
    const termsOverlay = document.getElementById('termsOverlay');
    const closeTerms = document.getElementById('closeTerms');

    // Logo fallback
    const logoImg = document.getElementById('logoImg');
    const logoFallback = document.getElementById('logoFallback');
    logoImg.addEventListener('error', () => {
      logoImg.style.display = 'none';
      logoFallback.style.display = 'block';
    });

    // Estado do fluxo (dados vêm do back; aqui é mock)
    let flow = {
      docRaw: '',
      docType: null, // 'CPF'|'CNPJ'
      resumoNome: '',
      nomeCompletoCorreto: '',
      opcoesNomeCompleto: [],
      details: null,
      offers: null,
    };

    function resetFlowState(){
      flow = {
        docRaw: '',
        docType: null,
        resumoNome: '',
        nomeCompletoCorreto: '',
        opcoesNomeCompleto: [],
        details: null,
        offers: null,
      };
      docInput.value = '';
      docInput.placeholder = '000.000.000-00';
    }

    // ========= Máscara CPF/CNPJ (digitando) =========
    function onlyDigits(s){ return (s || '').replace(/\D+/g, ''); }

    function maskCpf(v){
      v = onlyDigits(v).slice(0,11);
      v = v.replace(/^(\d{3})(\d)/, '$1.$2');
      v = v.replace(/^(\d{3})\.(\d{3})(\d)/, '$1.$2.$3');
      v = v.replace(/\.(\d{3})\.(\d{3})(\d{1,2})$/, '.$1.$2-$3');
      return v;
    }

    function maskCnpj(v){
      v = onlyDigits(v).slice(0,14);
      v = v.replace(/^(\d{2})(\d)/, '$1.$2');
      v = v.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
      v = v.replace(/\.(\d{3})(\d)/, '.$1/$2');
      v = v.replace(/\/(\d{4})(\d)/, '/$1-$2');
      return v;
    }

    function applyDynamicMask(){
      const d = onlyDigits(docInput.value);
      // Heurística: até 11, mascara CPF; acima, mascara CNPJ
      if (d.length > 11){
        docInput.value = maskCnpj(docInput.value);
        docInput.placeholder = '00.000.000/0000-00';
      } else {
        docInput.value = maskCpf(docInput.value);
        docInput.placeholder = '000.000.000-00';
      }
    }

    docInput.addEventListener('input', applyDynamicMask);

    // ========= MOCK de back (trocar pelo seu fetch real) =========
    async function fetchByDocument(docDigits){
      // SIMULA consulta no CRM
      await sleep(650);

      // Exemplo: se tiver 14 dígitos = CNPJ, retorna empresa
      if (docDigits.length === 14){
        return {
          type: 'CNPJ',
          resumoNome: 'N OLIVEIRA',            // resumo (pode ser 1 palavra)
          razaoCorreta: 'N OLIVEIRA COMÉRCIO LTDA',
          opcoes: [
            'N OLIVEIRA',
            'N OLIVEIRA COMÉRCIO LTDA',
            'N OLIVEIRA SERVIÇOS',
          ],
          details: {
            contrato: '205108950',
            credor: 'CREDOR EXEMPLO',
            vencimentoOriginal: '21/02/2024',
            valorOriginal: 'R$ 1.646,42',
            valorAtualizado: 'R$ 1.646,42',
          },
          offers: {
            parcelas: '24x de R$ 10,06',
            total: 'R$ 241,44',
          }
        };
      }

      // CPF
      return {
        type: 'CPF',
        resumoNome: 'ALEXANDRE VALENTE',
        nomeCorreto: 'ALEXANDRE VALENTE LEAL',
        opcoes: [
          'ALEXANDRE VALENTE LEAL',
          'ALEXANDRE VALENTE SILVA',
          'ALEXANDRE VALENTE SANTOS',
        ],
        details: {
          contrato: '10024099300',
          credor: 'CREDOR EXEMPLO',
          vencimentoOriginal: '21/02/2024',
          valorOriginal: 'R$ 1.646,42',
          valorAtualizado: 'R$ 1.646,42',
        },
        offers: {
          parcelas: '24x de R$ 10,06',
          total: 'R$ 241,44',
        }
      };
    }

    async function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

    // ========= Fluxo =========
    btnConsultar.addEventListener('click', async () => {
      const docDigits = onlyDigits(docInput.value);

      if (docDigits.length !== 11 && docDigits.length !== 14){
        // mantém UX sem “Não consegui entender”, mas indica no próprio input
        docInput.focus();
        docInput.style.borderColor = 'rgba(200,16,46,.65)';
        setTimeout(()=> docInput.style.borderColor='rgba(229,231,235,.9)', 600);
        return;
      }

      // define tipo e salva
      flow.docRaw = docDigits;
      flow.docType = (docDigits.length === 14) ? 'CNPJ' : 'CPF';

      // TELA 2: loading (somente a frase definida)
      pushAndShow('loading');

      try{
        const data = await fetchByDocument(docDigits);

        // popula estado
        flow.docType = data.type;
        flow.resumoNome = data.resumoNome;

        if (flow.docType === 'CPF'){
          flow.nomeCompletoCorreto = data.nomeCorreto;
          flow.opcoesNomeCompleto = data.opcoes;
        } else {
          // CNPJ: validação por razão social
          flow.nomeCompletoCorreto = data.razaoCorreta;
          flow.opcoesNomeCompleto = data.opcoes;
        }

        flow.details = data.details;
        flow.offers = data.offers;

        // TELA 3: resultado + confirmação
        renderConfirm();
        show('confirm'); // IMPORTANTE: não empilha loading na volta (loading só é transitório)
      }catch(e){
        renderError('Houve uma instabilidade ao consultar o documento. Tente novamente.');
        show('error');
      }
    });

    function renderConfirm(){
      // Centraliza a frase (pedido)
      if (flow.docType === 'CNPJ'){
        confirmText.innerHTML = `Localizamos o cadastro da empresa <strong>${escapeHtml(flow.resumoNome)}</strong>.<br>Você é responsável por esta empresa?`;
      } else {
        confirmText.innerHTML = `Localizamos o cadastro em nome de <strong>${escapeHtml(flow.resumoNome)}</strong>.<br>Estamos falando com essa pessoa?`;
      }
    }

    btnSim.addEventListener('click', () => {
      // ✅ NÃO pode voltar para loading.
      // Próximo passo: tela de confirmação do nome completo
      renderNameOptions();
      pushAndShow('verifyName');
    });

    btnNao.addEventListener('click', () => {
      // Tela de nova consulta COM explicação (pedido)
      newSearchMsg.textContent =
        'Por segurança, não exibimos informações quando o documento consultado não corresponde ao responsável. Reinicie a consulta com o documento correto.';
      pushAndShow('newSearch');
    });

    function renderNameOptions(){
      nameOptions.innerHTML = '';
      // Ajuste do título vazio (mantém espaçamento sem texto extra)
      // Subtítulo já está correto por pedido.

      flow.opcoesNomeCompleto.forEach(nome => {
        const b = document.createElement('button');
        b.type = 'button';
        b.className = 'btn same wide';
        b.textContent = nome;
        b.addEventListener('click', () => handleNamePick(nome));
        nameOptions.appendChild(b);
      });
    }

    function handleNamePick(nomeEscolhido){
      const ok = (nomeEscolhido || '').trim().toUpperCase() === (flow.nomeCompletoCorreto || '').trim().toUpperCase();

      if (!ok){
        // Deve ir para “Nova consulta” COM motivo + botão que volta ao início
        newSearchMsg.textContent =
          'Não foi possível validar o cadastro com as informações selecionadas. Para sua segurança, reinicie a consulta e informe o documento correto.';
        pushAndShow('newSearch');
        return;
      }

      // Validou: vai para a tela de direcionamento (autoatendimento x atendente)
      pushAndShow('nextStep');
    }

    btnAuto.addEventListener('click', () => {
      // NÃO pode abrir popup/alert. Deve ir para a tela do card.
      // (Se seu back ainda não devolver oferta, você pode cair em "error" ou mostrar “indisponível”.)
      if (!flow.offers || !flow.details){
        renderError('No momento não foi possível carregar as ofertas. Tente novamente em instantes.');
        pushAndShow('error');
        return;
      }
      offerParcelas.textContent = flow.offers.parcelas || '-';
      offerTotal.textContent = flow.offers.total || '-';
      pushAndShow('offer');
    });

    btnHumano.addEventListener('click', () => {
      // Link do chat humano (substituir pelo link real)
      btnAbrirChat.href = 'https://seu-link-de-chat-humano-aqui.exemplo';
      pushAndShow('human');
    });

    // Botões “voltar” e “nova consulta” devem voltar ao início
    btnVoltar.addEventListener('click', () => goBack());
    btnNovaConsulta.addEventListener('click', () => goHome());

    // Erro/instabilidade
    btnTentarNovamente.addEventListener('click', () => {
      // tenta repetir a última ação com o mesmo doc, se existir
      if (flow.docRaw){
        navStack.length = 0;
        show('loading');
        // reconsulta
        (async () => {
          try{
            const data = await fetchByDocument(flow.docRaw);
            flow.docType = data.type;
            flow.resumoNome = data.resumoNome;

            if (flow.docType === 'CPF'){
              flow.nomeCompletoCorreto = data.nomeCorreto;
              flow.opcoesNomeCompleto = data.opcoes;
            } else {
              flow.nomeCompletoCorreto = data.razaoCorreta;
              flow.opcoesNomeCompleto = data.opcoes;
            }

            flow.details = data.details;
            flow.offers = data.offers;
            renderConfirm();
            show('confirm');
          }catch(e){
            renderError('Ainda não foi possível concluir. Tente novamente em instantes.');
            show('error');
          }
        })();
      } else {
        goHome();
      }
    });

    btnVoltarInicio.addEventListener('click', () => goHome());

    function renderError(msg){
      document.getElementById('errorMsg').textContent = msg || 'Houve uma instabilidade no momento. Tente novamente.';
    }

    // Detalhes da dívida (modal reaproveitando o overlay)
    btnDetalhesDivida.addEventListener('click', () => {
      // Preenche conteúdo no modal (sem “cobrir tela toda”, com scroll interno)
      const body = termsOverlay.querySelector('.modalBody');
      body.innerHTML = `
        <h3>Detalhes da dívida</h3>
        <p><strong>Contrato:</strong> ${escapeHtml(flow.details?.contrato || '-')}</p>
        <p><strong>Credor:</strong> ${escapeHtml(flow.details?.credor || '-')}</p>
        <p><strong>Vencimento original:</strong> ${escapeHtml(flow.details?.vencimentoOriginal || '-')}</p>
        <p><strong>Valor original:</strong> ${escapeHtml(flow.details?.valorOriginal || '-')}</p>
        <p><strong>Valor atualizado:</strong> ${escapeHtml(flow.details?.valorAtualizado || '-')}</p>
        <div class="divider"></div>
        <p style="color:#6b7280;font-size:13px;margin:0;">
          Observação: as condições finais podem variar conforme atualização de cadastro e validações internas.
        </p>
      `;
      termsOverlay.style.display = 'flex';
    });

    // Ações do card (placeholder)
    btnQueroOferta.addEventListener('click', () => {
      renderError('Etapa seguinte: aqui você conecta com o back para geração do acordo/pagamento.');
      pushAndShow('error');
    });
    btnOutrasOfertas.addEventListener('click', () => {
      renderError('Etapa seguinte: aqui você carrega outras ofertas disponíveis no back.');
      pushAndShow('error');
    });

    // Termos e Política (modal)
    openTerms.addEventListener('click', (e) => {
      e.preventDefault();
      // restaura conteúdo padrão do modal
      restoreTermsContent();
      termsOverlay.style.display = 'flex';
    });

    closeTerms.addEventListener('click', () => termsOverlay.style.display = 'none');
    termsOverlay.addEventListener('click', (e) => {
      if (e.target === termsOverlay) termsOverlay.style.display = 'none';
    });

    function restoreTermsContent(){
      const body = termsOverlay.querySelector('.modalBody');
      body.innerHTML = `
        <h3>Compromisso com segurança e sigilo</h3>
        <p>
          A QuatroC adota medidas técnicas e organizacionais para proteger os dados utilizados neste portal,
          com foco em confidencialidade, integridade e disponibilidade das informações.
        </p>

        <h3>1) Finalidade do portal</h3>
        <p>
          Este portal viabiliza o autoatendimento para consulta de pendências e direcionamento do atendimento,
          de forma objetiva e segura.
        </p>

        <h3>2) Dados tratados</h3>
        <ul>
          <li>Documento informado (CPF ou CNPJ);</li>
          <li>Informações cadastrais necessárias para atendimento (ex.: contatos e endereços quando aplicável);</li>
          <li>Informações sobre pendências/encaminhamentos vinculados ao documento consultado.</li>
        </ul>

        <h3>3) Sigilo e acesso</h3>
        <p>
          Para reduzir exposição indevida, o portal pode solicitar validações adicionais antes de exibir informações.
          Não compartilhe seu documento com terceiros.
        </p>

        <h3>4) Boas práticas</h3>
        <ul>
          <li>Utilize rede e dispositivo confiáveis;</li>
          <li>Evite acessar o portal em equipamentos públicos;</li>
          <li>Finalize o atendimento ao concluir sua consulta.</li>
        </ul>

        <h3>5) Atendimento humano</h3>
        <p>
          Caso prefira, você pode optar por seguir com atendimento humano pelos canais disponibilizados neste portal.
        </p>
      `;
    }

    // Helpers
    function escapeHtml(str){
      return String(str ?? '')
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'","&#039;");
    }

    // start
    show('start');
  </script>
</body>
</html>
